const { assert, expect } = require("chai")
const { network, deployments, ethers } = require("hardhat")
const { developmentChains, networkConfig } = require("../../helper-hardhat-config")

const lowSvgImageURI =
    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4wIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiB3aWR0aD0iMjA0OC4wMDAwMDBwdCIgaGVpZ2h0PSIyMDQ4LjAwMDAwMHB0IiB2aWV3Qm94PSIwIDAgMjA0OC4wMDAwMDAgMjA0OC4wMDAwMDAiCiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCBtZWV0Ij4KCjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLDIwNDguMDAwMDAwKSBzY2FsZSgwLjEwMDAwMCwtMC4xMDAwMDApIgpmaWxsPSIjMDAwMDAwIiBzdHJva2U9Im5vbmUiPgo8cGF0aCBkPSJNMTkzNDUgMTUzNjMgYy0yODU1IC0xNjQ5IC01MzUzIC0zMTY2IC04MDI1IC00ODc2IC0xMzY5IC04NzYgLTM2MDEKLTIzNTkgLTQ2MzAgLTMwNzYgLTExOTcgLTgzNCAtMTgyMiAtMTI4MSAtMjQ5NSAtMTc4NSAtMjk5IC0yMjQgLTMxMCAtMjMyCi0zMDAgLTIxNSAxNSAyNCAxMDUwIDExMTkgMTYzNCAxNzI5IDEyMDcgMTI2MCAzMDUzIDMxMTkgNDAyMiA0MDUwIDEwMTkgOTgxCjIyMTQgMjA1NiAzMTM5IDI4MjUgMjkzIDI0NCA1MTcgNDM2IDc1OSA2NTAgMzYxIDMxOSAzODUgMzQwIDQyNCAzNjkgMjEgMTYKMzYgMzEgMzMgMzMgLTUgNSAtNjY1IC00NDEgLTkwMSAtNjA4IC05NDMgLTY3MSAtMjU2MSAtMjA1NyAtNDA0MCAtMzQ1OQotMTA1MCAtOTk3IC0yNjYzIC0yNjAxIC0zOTEwIC0zODkwIC03MDcgLTczMiAtOTI4IC05NjEgLTEzMzAgLTEzODAgLTU1NgotNTc5IC05MTkgLTk0MCAtMTIzNSAtMTIzMCAtMjI0IC0yMDUgLTI3MCAtMjU4IC0yNzAgLTMxNyAwIC01MyA3OCAtMTkwIDEzMwotMjM1IDU1IC00MyA2NiAtNDMgMTUyIDAgMTgxIDkwIDQyNSAyNjIgMTMxNSA5MjcgNjg4IDUxNCAxMDU2IDc4NyAxMzYwIDEwMTAKNzQgNTUgMTc2IDEyOSAyMjUgMTY1IDE5MiAxNDEgMTE3OCA4NTYgMTUxNSAxMTAwIDg2MSA2MjEgMjQyNSAxNzIwIDM2NjUKMjU3NyAxMjEwIDgzNSAzMTY3IDIxMzEgNDU4MCAzMDMxIDk3OCA2MjMgMzIzMSAyMDE0IDQzMDUgMjY1NyAzMDAgMTgwIDI3NQoxNjQgMjY5IDE2OSAtMiAyIC0xNzkgLTk3IC0zOTQgLTIyMXoiLz4KPC9nPgo8L3N2Zz4K"
const highSvgImageURI =
    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4wIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiB3aWR0aD0iMjA0OC4wMDAwMDBwdCIgaGVpZ2h0PSIyMDQ4LjAwMDAwMHB0IiB2aWV3Qm94PSIwIDAgMjA0OC4wMDAwMDAgMjA0OC4wMDAwMDAiCiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCBtZWV0Ij4KCjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLDIwNDguMDAwMDAwKSBzY2FsZSgwLjEwMDAwMCwtMC4xMDAwMDApIgpmaWxsPSIjMDAwMDAwIiBzdHJva2U9Im5vbmUiPgo8cGF0aCBkPSJNNzc2MCAxNjEzOCBjLTEwMSAtMTcgLTI2NSAtNjEgLTMxMCAtODQgLTIxOSAtMTA4IC0zODQgLTQwOCAtODEwCi0xNDY5IC00OTQgLTEyMzIgLTgzNCAtMjE5NSAtMjAzMiAtNTc2NSAtMzQ5IC0xMDQwIC01MjQgLTE1NDggLTY4NCAtMTk4NQotNjkgLTE4NyAtMTU3IC00MzkgLTE5NCAtNTYwIC0zOCAtMTIxIC05MCAtMjc2IC0xMTUgLTM0NCAtMjUgLTY4IC00NSAtMTMwCi00MyAtMTM5IDIgLTkgMzQgMzYgNzMgOTkgMzggNjIgMTE2IDE4OCAxNzIgMjc4IDE3OSAyODUgMzQ2IDY0MCA1OTYgMTI3MQoyNjMgNjYyIDQ0NyAxMTYwIDEzMjAgMzU2NSA2ODEgMTg3NSAxMDQ4IDI4MTkgMTQ1MSAzNzM0IDI2NSA2MDAgMzkyIDc5NyA1NDUKODQ5IDE0MCA0OCAzNjQgLTQ4IDYxNiAtMjYzIDI2NyAtMjI4IDU2NyAtNTM2IDEzMjcgLTEzNjIgMTM0OCAtMTQ2NiAxOTU2Ci0yMTA2IDM2MDMgLTM3OTMgNjUxIC02NjcgODM0IC04NTMgMjE5MCAtMjIyNSAxMTI1IC0xMTM5IDQwODcgLTQxMDYgNDA5MwotNDEwMCAzIDIgLTIyIDMzIC01NCA2OCAtMjU4MCAyNzYyIC0zMjAyIDM0NDMgLTU0NDkgNTk3MiAtMTI2MiAxNDIxIC0xOTY1CjIyMDggLTIxOTEgMjQ1NSAtMjMgMjUgLTE1NSAxNzEgLTI5NCAzMjUgLTI2NiAyOTQgLTI5MyAzMjQgLTczMCA3OTUgLTE1MAoxNjIgLTMyMyAzNDkgLTM4NCA0MTUgLTYxIDY2IC0xNDIgMTU0IC0xODEgMTk1IC04MyA4OSAtMjQxIDI2MCAtNDI1IDQ2MCAtNzQKODAgLTE1OSAxNzIgLTE5MCAyMDUgLTMxIDMzIC05NCAxMDAgLTE0MSAxNTAgLTM0MiAzNjUgLTY3MSA2ODkgLTg3MCA4NTYKLTE2OSAxNDMgLTI4NyAyMjMgLTQ0OSAzMDQgLTE5OCA5OSAtMjkwIDExOCAtNDQwIDkzeiIvPgo8L2c+Cjwvc3ZnPgo="
const lowTokenURI =
    "data:application/json;base64,eyJuYW1lIjoiRHluYW1pYyBTVkcgTkZUIiwgImRlc2NyaXB0aW9uIjoiQW4gTkZUIHRoYXQgY2hhbmdlcyBiYXNlZCBvbiB0aGUgQ2hhaW5saW5rIEZlZWQiLCAiYXR0cmlidXRlcyI6IFt7InRyYWl0X3R5cGUiOiAiY29vbG5lc3MiLCAidmFsdWUiOiAxMDB9XSwgImltYWdlIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJ6ZEdGdVpHRnNiMjVsUFNKdWJ5SS9QZ284SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURJd01ERXdPVEEwTHk5RlRpSUtJQ0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTlVVWk4eU1EQXhMMUpGUXkxVFZrY3RNakF3TVRBNU1EUXZSRlJFTDNOMlp6RXdMbVIwWkNJK0NqeHpkbWNnZG1WeWMybHZiajBpTVM0d0lpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUNpQjNhV1IwYUQwaU1qQTBPQzR3TURBd01EQndkQ0lnYUdWcFoyaDBQU0l5TURRNExqQXdNREF3TUhCMElpQjJhV1YzUW05NFBTSXdJREFnTWpBME9DNHdNREF3TURBZ01qQTBPQzR3TURBd01EQWlDaUJ3Y21WelpYSjJaVUZ6Y0dWamRGSmhkR2x2UFNKNFRXbGtXVTFwWkNCdFpXVjBJajRLQ2p4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLREF1TURBd01EQXdMREl3TkRndU1EQXdNREF3S1NCelkyRnNaU2d3TGpFd01EQXdNQ3d0TUM0eE1EQXdNREFwSWdwbWFXeHNQU0lqTURBd01EQXdJaUJ6ZEhKdmEyVTlJbTV2Ym1VaVBnbzhjR0YwYUNCa1BTSk5NVGt6TkRVZ01UVXpOak1nWXkweU9EVTFJQzB4TmpRNUlDMDFNelV6SUMwek1UWTJJQzA0TURJMUlDMDBPRGMySUMweE16WTVJQzA0TnpZZ0xUTTJNREVLTFRJek5Ua2dMVFEyTXpBZ0xUTXdOellnTFRFeE9UY2dMVGd6TkNBdE1UZ3lNaUF0TVRJNE1TQXRNalE1TlNBdE1UYzROU0F0TWprNUlDMHlNalFnTFRNeE1DQXRNak15Q2kwek1EQWdMVEl4TlNBeE5TQXlOQ0F4TURVd0lERXhNVGtnTVRZek5DQXhOekk1SURFeU1EY2dNVEkyTUNBek1EVXpJRE14TVRrZ05EQXlNaUEwTURVd0lERXdNVGtnT1RneENqSXlNVFFnTWpBMU5pQXpNVE01SURJNE1qVWdNamt6SURJME5DQTFNVGNnTkRNMklEYzFPU0EyTlRBZ016WXhJRE14T1NBek9EVWdNelF3SURReU5DQXpOamtnTWpFZ01UWUtNellnTXpFZ016TWdNek1nTFRVZ05TQXROalkxSUMwME5ERWdMVGt3TVNBdE5qQTRJQzA1TkRNZ0xUWTNNU0F0TWpVMk1TQXRNakExTnlBdE5EQTBNQ0F0TXpRMU9Rb3RNVEExTUNBdE9UazNJQzB5TmpZeklDMHlOakF4SUMwek9URXdJQzB6T0Rrd0lDMDNNRGNnTFRjek1pQXRPVEk0SUMwNU5qRWdMVEV6TXpBZ0xURXpPREFnTFRVMU5nb3ROVGM1SUMwNU1Ua2dMVGswTUNBdE1USXpOU0F0TVRJek1DQXRNakkwSUMweU1EVWdMVEkzTUNBdE1qVTRJQzB5TnpBZ0xUTXhOeUF3SUMwMU15QTNPQ0F0TVRrd0lERXpNd290TWpNMUlEVTFJQzAwTXlBMk5pQXRORE1nTVRVeUlEQWdNVGd4SURrd0lEUXlOU0F5TmpJZ01UTXhOU0E1TWpjZ05qZzRJRFV4TkNBeE1EVTJJRGM0TnlBeE16WXdJREV3TVRBS056UWdOVFVnTVRjMklERXlPU0F5TWpVZ01UWTFJREU1TWlBeE5ERWdNVEUzT0NBNE5UWWdNVFV4TlNBeE1UQXdJRGcyTVNBMk1qRWdNalF5TlNBeE56SXdJRE0yTmpVS01qVTNOeUF4TWpFd0lEZ3pOU0F6TVRZM0lESXhNekVnTkRVNE1DQXpNRE14SURrM09DQTJNak1nTXpJek1TQXlNREUwSURRek1EVWdNalkxTnlBek1EQWdNVGd3SURJM05Rb3hOalFnTWpZNUlERTJPU0F0TWlBeUlDMHhOemtnTFRrM0lDMHpPVFFnTFRJeU1Yb2lMejRLUEM5blBnbzhMM04yWno0SyJ9"
const highTokenURI =
    "data:application/json;base64,eyJuYW1lIjoiRHluYW1pYyBTVkcgTkZUIiwgImRlc2NyaXB0aW9uIjoiQW4gTkZUIHRoYXQgY2hhbmdlcyBiYXNlZCBvbiB0aGUgQ2hhaW5saW5rIEZlZWQiLCAiYXR0cmlidXRlcyI6IFt7InRyYWl0X3R5cGUiOiAiY29vbG5lc3MiLCAidmFsdWUiOiAxMDB9XSwgImltYWdlIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJ6ZEdGdVpHRnNiMjVsUFNKdWJ5SS9QZ284SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURJd01ERXdPVEEwTHk5RlRpSUtJQ0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTlVVWk4eU1EQXhMMUpGUXkxVFZrY3RNakF3TVRBNU1EUXZSRlJFTDNOMlp6RXdMbVIwWkNJK0NqeHpkbWNnZG1WeWMybHZiajBpTVM0d0lpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUNpQjNhV1IwYUQwaU1qQTBPQzR3TURBd01EQndkQ0lnYUdWcFoyaDBQU0l5TURRNExqQXdNREF3TUhCMElpQjJhV1YzUW05NFBTSXdJREFnTWpBME9DNHdNREF3TURBZ01qQTBPQzR3TURBd01EQWlDaUJ3Y21WelpYSjJaVUZ6Y0dWamRGSmhkR2x2UFNKNFRXbGtXVTFwWkNCdFpXVjBJajRLQ2p4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLREF1TURBd01EQXdMREl3TkRndU1EQXdNREF3S1NCelkyRnNaU2d3TGpFd01EQXdNQ3d0TUM0eE1EQXdNREFwSWdwbWFXeHNQU0lqTURBd01EQXdJaUJ6ZEhKdmEyVTlJbTV2Ym1VaVBnbzhjR0YwYUNCa1BTSk5OemMyTUNBeE5qRXpPQ0JqTFRFd01TQXRNVGNnTFRJMk5TQXROakVnTFRNeE1DQXRPRFFnTFRJeE9TQXRNVEE0SUMwek9EUWdMVFF3T0NBdE9ERXdDaTB4TkRZNUlDMDBPVFFnTFRFeU16SWdMVGd6TkNBdE1qRTVOU0F0TWpBek1pQXROVGMyTlNBdE16UTVJQzB4TURRd0lDMDFNalFnTFRFMU5EZ2dMVFk0TkNBdE1UazROUW90TmprZ0xURTROeUF0TVRVM0lDMDBNemtnTFRFNU5DQXROVFl3SUMwek9DQXRNVEl4SUMwNU1DQXRNamMySUMweE1UVWdMVE0wTkNBdE1qVWdMVFk0SUMwME5TQXRNVE13Q2kwME15QXRNVE01SURJZ0xUa2dNelFnTXpZZ056TWdPVGtnTXpnZ05qSWdNVEUySURFNE9DQXhOeklnTWpjNElERTNPU0F5T0RVZ016UTJJRFkwTUNBMU9UWWdNVEkzTVFveU5qTWdOall5SURRME55QXhNVFl3SURFek1qQWdNelUyTlNBMk9ERWdNVGczTlNBeE1EUTRJREk0TVRrZ01UUTFNU0F6TnpNMElESTJOU0EyTURBZ016a3lJRGM1TnlBMU5EVUtPRFE1SURFME1DQTBPQ0F6TmpRZ0xUUTRJRFl4TmlBdE1qWXpJREkyTnlBdE1qSTRJRFUyTnlBdE5UTTJJREV6TWpjZ0xURXpOaklnTVRNME9DQXRNVFEyTmlBeE9UVTJDaTB5TVRBMklETTJNRE1nTFRNM09UTWdOalV4SUMwMk5qY2dPRE0wSUMwNE5UTWdNakU1TUNBdE1qSXlOU0F4TVRJMUlDMHhNVE01SURRd09EY2dMVFF4TURZZ05EQTVNd290TkRFd01DQXpJRElnTFRJeUlETXpJQzAxTkNBMk9DQXRNalU0TUNBeU56WXlJQzB6TWpBeUlETTBORE1nTFRVME5Ea2dOVGszTWlBdE1USTJNaUF4TkRJeElDMHhPVFkxQ2pJeU1EZ2dMVEl4T1RFZ01qUTFOU0F0TWpNZ01qVWdMVEUxTlNBeE56RWdMVEk1TkNBek1qVWdMVEkyTmlBeU9UUWdMVEk1TXlBek1qUWdMVGN6TUNBM09UVWdMVEUxTUFveE5qSWdMVE15TXlBek5Ea2dMVE00TkNBME1UVWdMVFl4SURZMklDMHhORElnTVRVMElDMHhPREVnTVRrMUlDMDRNeUE0T1NBdE1qUXhJREkyTUNBdE5ESTFJRFEyTUNBdE56UUtPREFnTFRFMU9TQXhOeklnTFRFNU1DQXlNRFVnTFRNeElETXpJQzA1TkNBeE1EQWdMVEUwTVNBeE5UQWdMVE0wTWlBek5qVWdMVFkzTVNBMk9Ea2dMVGczTUNBNE5UWUtMVEUyT1NBeE5ETWdMVEk0TnlBeU1qTWdMVFEwT1NBek1EUWdMVEU1T0NBNU9TQXRNamt3SURFeE9DQXRORFF3SURremVpSXZQZ284TDJjK0Nqd3ZjM1puUGdvPSJ9"

!developmentChains.includes(network.name)
    ? describe.skip
    : describe("Dynamic SVG NFT Unit Tests", function () {
          let dynamicSvgNft, deployer, mockV3Aggregator

          beforeEach(async () => {
              accounts = await ethers.getSigners()
              deployer = accounts[0]
              await deployments.fixture(["mocks", "dynamicsvg"])
              dynamicSvgNft = await ethers.getContract("DynamicSvgNft")
              mockV3Aggregator = await ethers.getContract("MockV3Aggregator")
          })

          it("set values correctly", async function () {
              const lowSvg = await dynamicSvgNft.getLowSVG()
              const highSvg = await dynamicSvgNft.getHighSVG()
              const priceFeed = await dynamicSvgNft.getPriceFeed()
              assert.equal(lowSvg, lowSvgImageURI)
              assert.equal(highSvg, highSvgImageURI)
              assert.equal(priceFeed, mockV3Aggregator.address)
          })
          it("emit event and create NFT", async function () {
              const Value = ethers.utils.parseEther("10") // 10$ per ether
              await expect(dynamicSvgNft.mintNft(Value)).to.emit(dynamicSvgNft, "CreatedNFT")
              const tokenCounter = await dynamicSvgNft.getTokenCounter()
              assert.equal(tokenCounter.toString(), "1")
              const tokenURI = await dynamicSvgNft.tokenURI(0)
              assert.equal(tokenURI, highTokenURI)
          })
          it("changes NFT's", async function () {
              const Value = ethers.utils.parseEther("10000000") // 10 000 000 per ETH
              const txResponse = await dynamicSvgNft.mintNft(Value)
              await txResponse.wait(1)
              const tokenURI = await dynamicSvgNft.tokenURI(0)
              assert.equal(tokenURI, lowTokenURI)
          })
      })
